<!DOCTYPE html>
<html>
<head>
  <title>Province Heatmap</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map {
      height: 500px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chroma-js@2.1.0/chroma.min.js"></script>
  <script>
    $(document).ready(function() {
      // Define the data
      var data = [
  {
    "_id": "Ontario", 
    "cum_confirmed_cases": 436487621
  }, 
  {
    "_id": "Quebec", 
    "cum_confirmed_cases": 396869739
  }, 
  {
    "_id": "Alberta", 
    "cum_confirmed_cases": 312265701
  }, 
  {
    "_id": "BritishColumbia", 
    "cum_confirmed_cases": 197692349
  }, 
  {
    "_id": "Manitoba", 
    "cum_confirmed_cases": 82397753
  }, 
  {
    "_id": "Saskatchewan", 
    "cum_confirmed_cases": 50901860
  }, 
  {
    "_id": "NewBrunswick", 
    "cum_confirmed_cases": 19808333
  }, 
  {
    "_id": "NovaScotia", 
    "cum_confirmed_cases": 17072397
  }, 
  {
    "_id": "NewfoundlandandLabrador", 
    "cum_confirmed_cases": 13019523
  }, 
  {
    "_id": "Prince Edward Island", 
    "cum_confirmed_cases": 11016190
  }, 
  {
    "_id": "Northwest Territories", 
    "cum_confirmed_cases": 1670097
  }, 
  {
    "_id": "Yukon", 
    "cum_confirmed_cases": 1643006
  }, 
  {
    "_id": "Nunavut", 
    "cum_confirmed_cases": 431216
  }
];

      // Create the Leaflet map
      var map = L.map('map').setView([56.1304, -106.3468], 4);

      // Add the tile layer (you can use different tile layers depending on your preference)
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; OpenStreetMap contributors'
      }).addTo(map);

      // Define the color scale for the heatmap
      var colorScale = chroma.scale('OrRd').domain([0, getMaxValue(data)]);

      // Function to get the maximum value from the data
      function getMaxValue(data) {
        var max = 0;
        data.forEach(function(province) {
          if (province.cum_confirmed_cases > max) {
            max = province.cum_confirmed_cases;
          }
        });
        return max;
      }

      // Load the GeoJSON file
      $.getJSON('canada.geojson', function(geojson) {
        L.geoJSON(geojson, {
          style: function(feature) {
            // Find the corresponding data for the current province
            var provinceData = data.find(function(province) {
              return province._id === feature.properties.prov_name_en;
            });

            // Get the confirmed cases for the province
            var confirmedCases = provinceData ? provinceData.cum_confirmed_cases : 0;

            // Calculate the color based on confirmed cases using the color scale
            var fillColor = colorScale(confirmedCases).hex();

            // Return the style options for each province
            return {
              fillColor: fillColor,
              weight: 1,
              opacity: 1,
              color: 'white',
              fillOpacity: 0.7
            };
          },
          onEachFeature: function(feature, layer) {
            // Create a popup for each province showing the confirmed cases
            var provinceData = data.find(function(province) {
              return province._id === feature.properties.prov_name_en;
            });

            var confirmedCases = provinceData ? provinceData.cum_confirmed_cases : 0;

            var popupContent = '<b>' + feature.properties.prov_name_en + '</b><br>Cumulative Confirmed Cases: ' + confirmedCases;
            layer.bindPopup(popupContent);
          }
        }).addTo(map);
      });
    });
  </script>
</body>
</html>
